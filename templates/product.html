{% extends 'base.html' %}

{% block title %}
  {{ product.title }}
{% endblock %}

{% block content %}
  <div class="container" style="padding: 30px 0;">
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="col-lg-5 col-md-5 col-sm-6">
            <div style="height: 100%;" class="white-box text-center">
              <img onclick="window.open(`/media/{{ product.pro_img }}`)" style="height: 100%;width: 100%;" src="/media/{{ product.pro_img }}" class="img-responsive" />
            </div>
          </div>
          <div class="col-lg-7 col-md-7 col-sm-6">
            <h2 class="box-title mt-5">{{ product.title }}</h2>
            <ul class="px-0" style="color: gray;">
              <li>Model: {{ product.model_name }}</li>
              <li>Make: {{ product.make }}</li>
              <li></li>
            </ul>
            <h2 class="mt-5">
              <input type="text" value={{product.dis_price }} id="dis_price" hidden>
                <input type="text" value={{product.price }} id="price" hidden>
                <p id="fprice"></p>
                <script>
                  let dis_price = document.getElementById('dis_price').value;
                  let price = document.getElementById('price').value;
                  dis_price = +dis_price;
                  price = +price;
                  let fprice = document.getElementById('fprice')
                  if(dis_price<price){
                    fprice.innerHTML = `<h4><span style="text-decoration: line-through;"><i class="fa-solid fa-indian-rupee-sign" style="color: gray;"></i>${price}</span><strong><i class="fa-solid fa-indian-rupee-sign" style="margin-left: 5px;"></i>${dis_price}</strong></h4>`
                  }
                  else{
                    fprice.innerHTML = `
                    <h4><strong><i class="fa-solid fa-indian-rupee-sign"></i></strong><strong>${price}</strong></h4>`
                  }
                </script>
            </h2>
            <!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
  Contact for it
</button>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Check Out Form</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form action="{% url "customer" product.pro_id %}" id="myform" method="post">
          {% csrf_token %}
          
          <div class="mb-3">
            <label for="exampleInputEmail1" class="form-label">Enter your name</label>
            <input name="name" type="text" class="form-control" id="name">
          </div>
          <div class="mb-3">
            <label for="exampleInputPassword1" class="form-label">Enter your email</label>
            <input name="email" type="email" class="form-control" id="email" aria-describedby="emailHelp">
            <div id="emailHelp" class="form-text">We'll never share your email with anyone else.</div>
          </div>
          <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="exampleCheck1">
            <label class="form-check-label" for="exampleCheck1">Confirm</label>
          </div>
          <button type="submit" class="btn btn-primary">Submit</button>
          <script>
            let myform = document.getElementById('myform');
            myform.addEventListener('submit',(e)=>{
              localStorage.removeItem('customer_details');
              let data = {
                name:e.target.name.value,
                email:e.target.email.value
              }
              localStorage.setItem('customer_details',JSON.stringify(data));
            })
          </script>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
            <h3 class="box-title mt-5">Key Highlights</h3>
            <ul class="list-unstyled" id="desc">{{ product.description }}</ul>
            <script>
              let desc = document.getElementById('desc')
              let descValue = desc.innerHTML
              desc.innerHTML = ''
              descValue.split('*').map((des) => {
                if (des != '') desc.innerHTML += `<li> <i class="fa fa-check text-success"></i> ${des} </li>`
              })
            </script>
            <button onclick="window.open('/media/{{ product.datasheet }}','__blank')" class="btn btn-primary btn-rounded">Datasheet</button>
            <button onclick="window.open('/media/{{ product.manual }}','__blank')" class="btn btn-primary btn-rounded">Mannual</button>
          </div>
          <div class="col-lg-12 col-md-12 col-sm-12">
            <div class="d-flex mb-3">
            <input type="button" onclick="toggleSpec(1,this)" class="box-title mt-5 mx-2 btn btn-primary" value="Specification">
            <input type="button" onclick="toggleSpec(0,this)" class="box-title mt-5 mx-2 btn " value="About">
            </div>
            <div class="table-responsive" id="specification">
              <table class="table table-striped table-product">
                <tbody id="specs-table">
                  
                </tbody>
                  <input type="text" id="spec" value="{{ product.specification }}" hidden />
                  <script>
                    let specs = document.getElementById('spec').value;
                    let table = document.getElementById('specs-table');
                    specs.split('.').map((spec) => {
                      if (spec !== '') {
                          let [key,value] = spec.split('=');
                           table.innerHTML+=`
                           <tr>
                            <td width="390">${key}</td>
                            <td>${value}</td>
                          </tr>
                           `
                      }
                    })
                  </script>
                
              </table>
            </div>
          </div>
          <div class="col-lg-12 col-md-12 col-sm-12" > 
             <div style="font-size: 15px; color: #424242;" id="about">
                {{product.about}}
             </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      let data = localStorage.getItem('customer_details');
      if(data){
        data = JSON.parse(data);
        let form = document.getElementById('myform');
        form.name.value = data.name;
        form.email.value = data.email;
      }
      let about = document.getElementById('about');
      let spec = document.getElementById('specification');
      const hide = (ele)=>{
        ele.style.display = 'none';
      }
      const view = (ele)=>{
        ele.style.display = 'block';
      }
      const toggleSpec = (num,e=null)=>{
        if(num){
          view(spec);
          hide(about);
          if(e){
            e.nextElementSibling.classList.remove('btn-primary');
            e.classList.add('btn-primary');
          }
        }
        else{
          hide(spec);
          view(about);
          if(e){
            e.previousElementSibling.classList.remove('btn-primary');
            e.classList.add('btn-primary');
          }
        } 
      }
      toggleSpec(1);
    </script>
  </div>
{% endblock %}
